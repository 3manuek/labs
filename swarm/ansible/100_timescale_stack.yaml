---
- name: Copy files with labs
  hosts: all
  tasks:
    - name: Copy folder to hosts
      ansible.builtin.copy:
        src: './timescale-ha'
        remote_src: false
        dest: './' # home ubuntu
        mode: '0755'
  # become: true 
  tags: [copy]
  
- name: Remove stack 
  hosts: node1
  tasks:
    - name: Remove stack
      ansible.builtin.shell: docker stack rm {{ docker_stack }}
    # - name: Wait stack to clean
    #   ansible.builtin.wait_for:
    #     timeout: 10
    #     delay: 1
    #     state: gone
  tags: [remove]

# Spawn docker stack
- name: Spawn docker stack
  hosts: node1
  # become: true
  tasks:
    - name: Spawn docker stack
      ansible.builtin.shell: docker stack deploy -c docker-stack.yaml {{ docker_stack }}
      args:
        chdir: ./timescale-ha
  tags: [deploy]

